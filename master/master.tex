%% DO NOT EDIT THIS FILE IF YOU DO NOT KNOW WHAT YOU ARE DOING
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% We need to be able to change the font size, paper
%% size and the class. We take the defaults from the
%% lecturer's documentclass command and provide them
%% as defaults
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\providecommand{\pointsize}{12pt}
\providecommand{\papersize}{a4paper}
\providecommand{\class}{article}
\providecommand{\emphasis}{clear}
%% We need to know if we are in a nonstandard class
\providecommand{\unknownclass}{}
\providecommand{\originalclass}{}
%% Beamer is even more special 
\providecommand{\beamerslides}{}
\providecommand{\beamerhandout}{}
%% As is flushed left equations
\providecommand{\fleqn}{}
\providecommand{\beamerfix}{}
\providecommand{\colorhere}{}
\documentclass[\pointsize,\papersize,\beamerhandout,\fleqn,\beamerfix,\colorhere]{\class}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Babel package to specify English typographical 
%% rules, and hyphenation patterns
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[english,shorthands=off]{babel}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% T1 font encoding to ensure characters with accents 
%% and other non-ascii characters can be correctly 
%% searched, copied and pasted in the PDF output. Also 
%% enables hyphenation of words containing letters 
%% with accents.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[T1]{fontenc}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% This is the master for 5 document formats.
%% We DO NOT support compiling via latex-dvips-ps2pdf. 
%% You must compile using the makefile
\usepackage{etoolbox}
\newtoggle{clearprint}
\newtoggle{large}
\newtoggle{web}
\newtoggle{word}
\newtoggle{figures}
\newtoggle{frontmatter}
\newtoggle{contents}
%% Please note that compilation requires a post-2009 version 
%% of etoolbox and a variety of pieces of software.  
%% You should use linux.bath.ac.uk to compile and you
%% must use the makefile.
\input{toggle.tex}
\input{choices.tex}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% The disclaimer:
\newcommand{\inputdisclaimer}{}
%%\usepackage{bathmathsdisclaimer}

%% Is this an unknown class? If so try to kludge it
%% Some classes DO NOT HAVE 12pt even!
\ifdefstring{\unknownclass}{true}{\usepackage[\pointsize]{extsizes}}{}

%% Do we have a known original class we are fixing?
\ifdefstring{\originalclass}{tufte-book}{\usepackage{tuftefix}}{}

%% Are these a web or word version of beamer slides?
\ifdefstring{\beamerslides}{true}{\usepackage[notheorems,hyperref]{beamerarticle}}{}

%% Beamer with below settings already meets requirements
%% for clear and large print
\ifdefstring{\class}{beamer}{
\togglefalse{clearprint}
\togglefalse{large}
\usefonttheme{default}
\usefonttheme[onlymath]{serif}
\usepackage{beamerfix}
}{}

\ifdefstring{\fleqn}{fleqn}{
\newcommand{\displaywhere}{left}
%\belowdisplayskip = -10pt plus 2pt
%\abovedisplayskip = -10pt plus 2pt
}{
\newcommand{\displaywhere}{center}
}

\iftoggle{large}{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Note, you should have cm-super installed otherwise
%% computer modern fonts will be bitmaps. 
%% Or, load lmodern.
%% We cannot use lmodern with 14pt, 17pt or 20pt
%% as large symbols are incorrectly sized
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}{\usepackage{lmodern}}

%% Graphicx must be loaded whether used or not as 
%% TeX4ht compilation expects it.
%% This is incompatible with some ways of making diagrams
\usepackage{graphicx}
%% Due to the processing requirements of graphics we have
%% set up a directory structure that must be used
\graphicspath{{./figures/latexpdfsvg/}{./figures/svg/}{./figures/eps/}{./figures/pdf/}{./figures/png/}{./figures/jpg/}{./figures/latexpdf/}} 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Emergency commands to force math in standard and
%% clear to be within the line width but without
%% affecting large, web or word
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\DeclareRobustCommand{\mathaltemergencyresize}[1]{
  \resizebox{\linewidth}{!}{$ #1 $}}


%% Level of reliance on amsmath means we require this
%% syntax and fix things that it will not accept
\usepackage{amsmath}

\ifboolexpr{togl {clearprint} or togl {web}}{
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 %% Packages we rely on loaded
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 \usepackage[a4paper,margin=2.5cm]{geometry}
 \usepackage{spverbatim}
 \usepackage{listings}
 
 \lstloadlanguages{Matlab} %Other languages are available, see manual, you should select the correct language
 \lstset{
   basicstyle=\ttfamily, 
   breaklines=true, 
   columns=fixed 
  }
 \usepackage{amssymb,amsfonts,amsthm}
 \ifpdf
  \usepackage{xr-hyper}
  \usepackage{hyperref}
 \else
  \ifundef{\href}{\newcommand{\href}[2]{\HCode{<a href="#1">#2</a>}}}{}
  \ifundef{\texorpdfstring}{\newcommand{\texorpdfstring}[2]{{#1}}}{}
  \ifundef{\url}{\newcommand{\url}[1]{\HCode{<a href="#1">#1</a>}}}{}
 \fi
 %% This is our fix for displayoperators in web format
 \usepackage{displayoperators}
 \iftoggle{large}{\usepackage{lscape}}

 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 %% Clear print set up
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 %% Change font to Helvetica and heavier verbatim font
 \renewcommand{\familydefault}{phv}
 \fontfamily{phv}\selectfont
 \iftoggle{web}{}{\usepackage[scaled=0.95]{DejaVuSansMono}}

 %% Emphasis in bold only - add additional examples 
 %% as per resource
 %% In web format we are in clearprint with clear emphasis
 %% In web standard format we are in clearprint with standard emphasis
 %% but we need to redefine em to be it in that case so it is <i> not
 %% a particular font
 \ifdefstring{\emphasis}{clear}{\renewcommand{\em}{\bf}\renewcommand{\textit}{\textbf}\renewcommand{\emph}{\textbf}\renewcommand{\it}{\bf }\renewcommand{\itshape}{\bf}}{\renewcommand{\em}{\it}\renewcommand{\emph}{\textit}}
 %%Not sure about the last one, if it is a problem generally
 %%stick it in tuftefix for now 
 
 %% Additional spacing - may not be honoured in 
 %% web version
 \setlength{\parindent}{0.0pt}
 \setlength{\parskip}{1.0\baselineskip}
 \renewcommand{\baselinestretch}{1.25}\selectfont
 \AtBeginEnvironment{tikzcd}{\setlength{\mathsurround}{0pt}}
 \mathsurround 0.2em
 \setlength{\arraycolsep}{0.5cm}\renewcommand{\arraystretch}{1.25}
 \addtolength{\jot}{0.5\baselineskip}
 \renewcommand{\;}{\,}
 \sloppy
 \allowdisplaybreaks
 \newtheoremstyle{plain}{20pt}{3pt}{}{}{\bfseries}{.\newline\nobreak}{1.0em\nobreak}{}
 \newtheoremstyle{definition}{20pt}{3pt}{}{}{\bfseries}{.\newline\nobreak}{1.0em\nobreak}{}
 \newtheoremstyle{remark}{20pt}{3pt}{}{}{\bfseries}{.\newline\nobreak}{1.0em\nobreak}{}
 \newenvironment{Proof}
  {\noindent{\bf Proof.}\hspace*{1em}}% Begin
  {\qed\par}% End
 %% When redefining an environment it is vital that it has 
 %% the same number of arguments as the original
 \renewenvironment{proof}[1][\proofname]
  {\trivlist\item\relax\noindent{\bf {#1}.}\hspace*{1em}}% Begin
  {\qed\endtrivlist}% End
 %% Do the least you can, this should preserve more of proof
 %%\let\oldproofname=\proofname
 %%\renewcommand{\proofname}{\rm\bf{\oldproofname}}

 \ifdefstring{\beamerslides}{true}{
  \newtheorem*{example}{Example}
  \newtheorem*{definition}{Definition}
  \newtheorem*{corollary}{Corollary}
  \newtheorem*{lemma}{Lemma}
  \newtheorem*{theorem}{Theorem}
  \newtheorem*{notes}{Note}
 }{}

 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 %% Commands used to provide alternative text for 
 %% diagrams for a screenreader user.
 %% DO NOT remove the macros from the preamble even if
 %% you are not using them as the web compilation 
 %% expects them to be defined.
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 \newcommand{\nextalt}[1]{} 
 \newcommand{\PICalt}[1]{{#1}} 

 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 %% Ensure front matter and table of contents are 
 %% page numbered separately from the body
 %% Use headings style so that each page has a label
 \pagestyle{headings}
 \pagenumbering{roman}
 \iftoggle{frontmatter}{
 \title{Please set a title for these notes or toggle frontmatter off if a title is inappropriate}
 \author{Please set an author for these notes or toggle frontmatter off if a title is inappropriate}
 \date{Please set a date for these notes or toggle frontmatter off if a title is inappropriate}
 }{}
 \ifdefstring{\beamerslides}{true}{\date{}}{}
 \AfterEndPreamble{
  \iftoggle{frontmatter}{\renewcommand{\baselinestretch}{1.0}\selectfont\maketitle\renewcommand{\baselinestretch}{1.25}\selectfont\inputdisclaimer}{}
  \iftoggle{contents}{\tableofcontents\listoffigures\listoftables  \iftoggle{web}{\ifdefstring{\beamerslides}{true}{\section*{Start of slides}}{}}{}\renewcommand{\tableofcontents}{}\renewcommand{\listoffigures}{}\renewcommand{\listoftables}{}\newpage}{\iftoggle{frontmatter}{\newpage}{}}
  \pagenumbering{arabic}        
  \setcounter{page}{1}
 }
 \AtEndPreamble{
  \ifboolexpr{togl {clearprint} or togl {large} or togl {web} or togl {figures}}{
   \newgeometry{a4paper,margin=2.5cm}
  }{}
  \ifboolexpr{togl {clearprint} or togl {large}}{
   \pretocmd{\section}{\ifnum\value{section}=0 \else\clearpage\fi}{}{}
  }{}
  \iftoggle{web}{
    %% A mathjax bug is causing problems with \binom so we have to redefine it for now:
    \renewcommand{\dbinom}[2]{\textstyle\left(\begin{array}{c}{#1} \\ {#2}\end{array}\right)}
    \renewcommand{\binom}[2]{\left(\begin{array}{c}{#1} \\ {#2}\end{array}\right)}
    \renewcommand{\displaylimits}{}
  }{}
  \iftoggle{figures}{\usepackage{figurefix}}{}
  \iftoggle{web}{
   %%%\usepackage{bbmone}
   \usepackage{webfix}
   \usepackage{color}
   \usepackage{xcolor}
   \usepackage{colorfix}
   \usepackage{fakeframed}
   \definecolor{shadecolor}{gray}{0.95}
   \BeforeBeginEnvironment{lstlisting}{\begin{shaded}}
   \AfterEndEnvironment{lstlisting}{\end{shaded}}
  }{}

  \ifboolexpr{togl {word} or togl {web} or togl {figures}}{}{\newenvironment{mytikz}{\begin{center}\begin{tikzcd}[ampersand replacement=\&]}{\end{tikzcd}\end{center}}}

  \iftoggle{clearprint}{\newcommand{\scalefactor}{1.1}}{}
  \iftoggle{large}{\renewcommand{\scalefactor}{1.4}}{}
  \ifboolexpr{togl {clearprint} or togl {large}}{\usepackage{fontfix}}{}
  \ifdefstring{\class}{beamer}{\usepackage{beamerfix}}{}
  \ifdefstring{\beamerslides}{true}{\usepackage{beamerfix}}{}
 }
 \iftoggle{web}{\usepackage{webprevent}}{}
 \iftoggle{large}{\usepackage{largeprevent}}{} 

 \ifdefstring{\beamerslides}{true}{
  \mode<article>{\setbeamertemplate{frametitle}{%
   \rule{\textwidth}{1pt}
   \par
   \section{\insertframetitle}
   }
  }
 }{}

}{
\newenvironment{mytikz}{\begin{center}\begin{tikzcd}[ampersand replacement=\&]}{\end{tikzcd}\end{center}}
%% In the standard format I still might need to insert a disclaimer but it shouldn't be there if maketitle is used in beamer, we do it a different way in beamer
\ifdefstring{\class}{beamer}{\appto{\titlepage}{\tiny Lecture notes and audio recording, Department of Mathematical Sciences, The University of Bath\footnote{\tiny\inputdisclaimer}}}{\appto{\maketitle}{\inputdisclaimer}}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Leave a blank line after this

%% DO NOT EDIT THIS FILE IF YOU DO NOT KNOW WHAT YOU ARE DOING

