\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{webfix}[2018/01/25]
\RequirePackage{environ}

%% There are some packages that we can allow to load but we need to stop certain things then happening
\@ifpackageloaded{tikz}{
 \usetikzlibrary{external}
 \tikzexternalize[mode=only graphics]
%%  I have hacked together a solution which allows us to externalise tikzcd... but keep an eye on the results
%% \AtBeginEnvironment{tikzcd}{\tikzexternaldisable}
%% \AtEndEnvironment{tikzcd}{\tikzexternalenable}
  \NewEnviron{mytikz}[1][]{\begin{figure}[htp] \begin{center} \begin{tikzpicture}[#1] \node {\begin{tikzcd}[ampersand replacement=\&] \BODY \end{tikzcd}}; \end{tikzpicture} \end{center} \end{figure}}
 \tikzset{
  pdf export/.style={
   /pgf/images/external info,
   /pgf/images/include external/.code={%
    \includegraphics{##1.pdf}%
   }
  }
 }
 \tikzset{pdf export}
}{}

